#!/bin/bash
set -euo pipefail

# GLM wrapper - Runs Claude Code with Z.AI/GLM models via environment variables

# Get Z.AI API key from pass
ZAI_API_KEY=$(pass show llm/glm_api_key 2>/dev/null | head -1)

if [ -z "$ZAI_API_KEY" ]; then
    echo "Error: Could not retrieve Z.AI API key from pass" >&2
    echo "Run: pass show llm/glm_api_key" >&2
    exit 1
fi

echo "Launching Claude with GLM models (Z.AI)..." >&2

# Export GLM-specific environment variables
export ANTHROPIC_AUTH_TOKEN="$ZAI_API_KEY"
export ANTHROPIC_BASE_URL="https://api.z.ai/api/anthropic"
export API_TIMEOUT_MS="3000000"
export ANTHROPIC_DEFAULT_OPUS_MODEL="glm-4.6"
export ANTHROPIC_DEFAULT_SONNET_MODEL="glm-4.6"
export ANTHROPIC_DEFAULT_HAIKU_MODEL="glm-4.5-air"

# Launch Claude Code with all arguments
# Environment variables override settings.json
exec claude "$@"
