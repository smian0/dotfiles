# Known Issues - Claude OAuth Token Utility

## Current Issues

### 1. OAuth Token Authentication Bug - Max Plan Not Recognized

**Status**: üî¥ Active Bug (As of August 2025)  
**Affects**: Users with Claude Max plans using OAuth tokens  
**GitHub Issue**: [#5625 - Long-lived token use doesn't recognize Max subscription](https://github.com/anthropics/claude-code/issues/5625)

#### Problem Description
When using OAuth tokens generated by this utility, Claude Code incorrectly identifies Max plan subscribers as Pro plan users, resulting in:
- Opus model access denied
- Error message: "Claude Pro users are not currently able to use Opus in Claude Code. The current model is now Sonnet."
- Forced fallback to Sonnet models only

#### Root Cause
Long-lived OAuth tokens are not properly validating subscription tier information, causing Max subscription benefits to be ignored during authentication.

#### Current Workaround
```bash
# Temporarily disable OAuth token to use regular authentication
unset CLAUDE_CODE_OAUTH_TOKEN

# Restart Claude Code to pick up regular authentication
# Max plan features (including Opus access) should work normally
```

#### Expected Behavior
- Max plan users should have access to both Sonnet 4 and Opus 4 models
- OAuth tokens should correctly identify and respect subscription tiers
- No difference in model availability between OAuth and regular authentication

#### Testing Steps
1. Generate OAuth token using this utility
2. Set `CLAUDE_CODE_OAUTH_TOKEN` environment variable
3. Start Claude Code
4. Attempt to use Opus model - should fail with Pro user message
5. Unset OAuth token and restart - Opus should become available

#### Impact
- Prevents Max plan subscribers from accessing paid tier benefits when using OAuth
- Forces users to choose between OAuth convenience and full model access
- May affect automated workflows relying on OAuth authentication

---

## Fixed Issues

*No fixed issues yet - this section will be updated when bugs are resolved*

---

## How to Check if Issues Are Fixed

### OAuth Authentication Bug Check

Run this test to verify if the OAuth bug has been resolved:

```bash
#!/bin/bash
# Test script: test_oauth_model_access.sh

echo "üîç Testing OAuth Token Model Access..."

# Check if we have OAuth token
if [ -z "$CLAUDE_CODE_OAUTH_TOKEN" ]; then
    echo "‚ùå No OAuth token found. Generate one first with: bun run oauth"
    exit 1
fi

echo "‚úÖ OAuth token found"
echo "üöÄ Starting Claude Code test..."

# Test if Opus is available (this will need manual verification)
echo ""
echo "üìù Manual Test Required:"
echo "1. Run: claude"
echo "2. Try: /model opus"
echo "3. If successful: OAuth bug is FIXED ‚úÖ"
echo "4. If error about Pro users: OAuth bug still EXISTS ‚ùå"
echo ""
echo "Expected when FIXED: Opus model should be selectable without errors"
echo "Current behavior: 'Claude Pro users are not currently able to use Opus'"
```

### Monitoring Commands

```bash
# Check GitHub issue status
gh issue view 5625 --repo anthropics/claude-code

# Check for new releases that might fix the issue
gh release list --repo anthropics/claude-code

# Test current authentication method
echo "Current auth method: $([ -n "$CLAUDE_CODE_OAUTH_TOKEN" ] && echo "OAuth Token" || echo "Regular Auth")"
```

---

## Update Log

- **2025-08-20**: Initial documentation of OAuth authentication bug
- **Next Update**: TBD - Check monthly or when Claude Code releases updates

---

## Related Files

- `index.ts` - Main OAuth token generation utility
- `scripts/quick-token.js` - Interactive token generator
- `USAGE.md` - General usage instructions
- This file - Issue tracking and workarounds