# Simple Alpine-based container for dotfiles testing
# Alpine is more reliable and faster than Ubuntu for testing
FROM alpine:latest

# Install essential packages
RUN apk add --no-cache \
    bash \
    curl \
    git \
    gnupg \
    make \
    nodejs \
    npm \
    stow \
    sudo \
    zsh

# Create test user
RUN adduser -D -s /bin/zsh testuser && \
    echo "testuser ALL=(ALL) NOPASSWD:ALL" >> /etc/sudoers

# Switch to test user
USER testuser
WORKDIR /home/testuser

# Set up minimal GPG configuration for testing
RUN mkdir -p ~/.gnupg && \
    chmod 700 ~/.gnupg && \
    echo "use-agent" > ~/.gnupg/gpg.conf && \
    echo "pinentry-mode loopback" >> ~/.gnupg/gpg.conf

# Keep container running
CMD ["tail", "-f", "/dev/null"]